
$.loadDataTemplate="/notificaciones/loadDataTemplate";$.searchDataTemplate="/notificaciones/searchDataTemplate";$.deleteDataTemplate="/notificaciones/deleteDataTemplate";$(document).ready(function(){$("#newTemplate-btn").on("click",function(a){a.preventDefault();loadDataTemplate()});$("#saveTemplate-btn").on("click",function(a){a.preventDefault();if($("#contenidoSms").val().trim()===""){$("#leyendaContenidoSms").html("<small style='color: red;'>Debe introducir el texto de la plantilla</small>")}else{if($("#contenidoSms").val().trim().length>200){$("#leyendaContenidoSms").html("<small style='color: red;'>El texto no puede contener más de 300 caracteres</small>")}else{$("#leyendaContenidoSms").html("");saveTemplate()}}});$("#editTemplate-btn").on("click",function(a){a.preventDefault();searchDataTemplate()});$("#deleteTemplate-btn").on("click",function(a){a.preventDefault();deleteTemplate()})});function initDroppable(a){a.droppable({accept:":not(.ui-sortable-helper)",drop:function(b,h){var i=h.draggable.text();var f;f=" ${"+i+"} ";var d=document.getElementById("contenidoSms");var j=d.selectionStart;var c=d.value;var g=c.substring(0,j);var e=c.substring(j,c.length);d.value=g+f+e}})}function loadDataTemplate(){$.ajax({type:"POST",dataType:"json",url:$.loadDataTemplate,success:function(b){var a=b;loadAvailableFields(a);$("#idNotificacion").val($("#idConfiguracionNotificacion").val());$("#contenidoSms").val("");initDroppable($("#contenidoSms"));$("#leyendaContenidoSms").html("");openModal("modalPlantillaSms")},error:function(a,c,b){sweetAlert("Oops...","Algo salió mal, intenta nuevamente en unos minutos.","error")}})}function saveTemplate(){var b=$("#formAddTemplate");var a=new FormData($(b)[0]);var c=$(b).attr("action");$.ajax({url:c,type:"POST",data:a,cache:false,contentType:false,processData:false,success:function(d){$("#templateSms").html(d.templateSms);$("#idConfiguracionNotificacion").val(d.notificacion);$("#newTemplate").css("display","none");$("#contentTemplate").css("display","block");$("#editTemplate-div").css("display","block");$("#deleteTemplate-div").css("display","block");$("#emptyCronContent").css("display","none");if($("#cronContent").css("display")==="none"){$("#newCron").css("display","block")}cerrarModal("modalPlantillaSms");sweetAlert({html:false,title:"¡Excelente!",text:"La plantilla se ha guardado correctamente.",type:"success"})},error:function(d,f,e){sweetAlert("Oops...","Algo salió mal, intenta nuevamente en unos minutos.","error")}})}function searchDataTemplate(){$.ajax({type:"POST",dataType:"json",url:$.searchDataTemplate,success:function(b){var a=b.availableOptions;loadAvailableFields(a);$("#idNotificacion").val($("#idConfiguracionNotificacion").val());$("#contenidoSms").val(b.templateSms);initDroppable($("#contenidoSms"));$("#leyendaContenidoSms").html("");openModal("modalPlantillaSms")},error:function(a,c,b){sweetAlert("Oops...","Algo salió mal, intenta nuevamente en unos minutos.","error")}})}function loadAvailableFields(a){$("#availableFields li").remove();$.each(a,function(){var b='<li class="gray font14 fontWeight500 latterspacing1 paddingTop12" style="cursor:move">';b+=this;b+="</li>";$("#availableFields").append(b)});$("#availableFields li").draggable({appendTo:"body",helper:"clone",cursor:"move",revert:"invalid"})}function deleteTemplate(){swal({title:"¡Importante!",text:"¿Está seguro que desea eliminar la plantilla definitivamente?",type:"warning",showCancelButton:true,cancelButtonText:"Me equivoque en la selección",confirmButtonColor:"#DD6B55",confirmButtonText:"Sí, continuar",closeOnConfirm:false},function(a){if(a){$.ajax({type:"POST",dataType:"json",url:$.deleteDataTemplate,data:"idNotificacion="+$("#idConfiguracionNotificacion").val(),success:function(b){if(b.confirm===true){$("#idConfiguracionNotificacion").val("0");$("#newTemplate").css("display","block");$("#contentTemplate").css("display","none");$("#editTemplate-div").css("display","none");$("#deleteTemplate-div").css("display","none");$("#emptyCronContent-td").html("<strong>No se ha configurado ninguna plantilla para el envío de mensajes</strong>");$("#emptyCronContent").css("display","block");$("#newCron").css("display","none");$("#cronContent").css("display","none");$("#editCron-div").css("display","none");$("#deleteCron-div").css("display","none");sweetAlert({html:false,title:"¡Excelente!",text:"La plantilla se ha eliminado correctamente.",type:"success"})}},error:function(b,d,c){sweetAlert("Oops...","Algo salió mal, intenta nuevamente en unos minutos.","error")}})}})};