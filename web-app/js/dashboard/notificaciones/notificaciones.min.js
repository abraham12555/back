
$.getSmsTemplates=$.contextAwarePathJS+"notificaciones/getSmsTemplates";$.loadDataSmsTemplate=$.contextAwarePathJS+"notificaciones/loadDataSmsTemplate";$.viewSmsTemplateDetails=$.contextAwarePathJS+"notificaciones/viewTemplateDetails";$.deleteSmsTemplate=$.contextAwarePathJS+"notificaciones/deleteSmsTemplate";$(document).ready(function(){$("#newSmsTemplate-btn").on("click",function(a){a.preventDefault();loadDataSmsTemplate()});$("#saveSmsTemplate-btn").on("click",function(a){a.preventDefault();validateTemplate()});$("#plantillasSms-tb").on("click","button.smsTemplateDetails",function(b){b.preventDefault();var a=this.getAttribute("data-id");viewSmsTemplateDetails(a)});$("#plantillasSms-tb").on("click","button.deleteSmsTemplate",function(b){b.preventDefault();var a=this.getAttribute("data-id");deleteSmsTemplate(a)});getSmsTemplates()});function getSmsTemplates(){$.ajax({type:"POST",dataType:"json",url:$.getSmsTemplates,contentType:"application/json",success:function(a){$("#plantillasSms-tb tbody").empty();if(a.templates.length>0){$.each(a.templates,function(c){var d="";if(c===0){d+="<tr></tr>"}d+="<tr>";d+='<td class="left tableTitleColor font12 paddingTop12 paddingRight12 paddingBottom5 paddingLeft10 textUpper">';d+='<span class="textUpper">estatus </span><br/>';d+='<span class="font14 tableDescriptionColor textUpper">'+this.status+"</span>";d+="</td>";d+='<td class="left tableTitleColor font12 paddingTop12 paddingRight12 paddingBottom5 paddingLeft10">';d+='<span class="textUpper">plantilla </span><br/>';d+='<span class="font14 tableDescriptionColor">'+this.plantilla+"</span>";d+="</td>";d+='<td class="center colorWhite font14 paddingTop5 paddingRight12 paddingBottom5 paddingLeft10 textUpper">';d+='<button class="greenBox colorWhite width100 smsTemplateDetails" data-id="'+this.id+'" type="button">editar</button>';d+="</td>";d+='<td class="center colorWhite font14 paddingTop5 paddingRight12 paddingBottom5 paddingLeft10 textUpper">';d+='<button class="greenBox colorWhite width100 deleteSmsTemplate" data-id="'+this.id+'" type="button">eliminar</button>';d+="</td>";d+="</tr>";$("#plantillasSms-tb tbody:last").append(d)});if(a.statusOption){$("#newSmsTemplate-btn").css("display","block")}else{$("#newSmsTemplate-btn").css("display","none")}}else{var b="";b+="<tr></tr>";b+="<tr>";b+='<td colspan="4" class="left tableTitleColor font12 paddingTop12 paddingRight12 paddingBottom5 paddingLeft10 textUpper">';b+='<span class="font14 tableDescriptionColor">No hay plantillas registradas</span>';b+="</td>";b+="</tr>";$("#plantillasSms-tb tbody:last").append(b)}},error:function(a,c,b){sweetAlert("Oops...","Algo salió mal, intenta nuevamente en unos minutos.","error")}})}function initDroppable(a){a.droppable({accept:":not(.ui-sortable-helper)",drop:function(f,h){var c=h.draggable.text();var e;e="{"+c+"}";var b=a[0].selectionStart;var i=a.val();var g=i.substring(0,b);var d=i.substring(b,i.length);a.val(g+e+d)}})}function loadDataSmsTemplate(){$.ajax({type:"POST",dataType:"json",url:$.loadDataSmsTemplate,beforeSend:function(b,a){$('span[class*="help-block"]').each(function(){$(this).remove()});$("#status-div").empty()},success:function(a){$("#formAddTemplate")[0].reset();$("#idTemplate").val("0");$("#statusConfig-div").css("display","block");loadAvailableFields(a.fields);$.each(a.status,function(){var b=$('<input name="status" value="'+this+'" type="radio"> <span class="marginRight20">'+this+"</span>");b.appendTo("#status-div")});initDroppable($("#contenidoSms"));openModal("modalPlantillaSms")},error:function(a,c,b){sweetAlert("Oops...","Algo salió mal, intenta nuevamente en unos minutos.","error")}})}function saveSmsTemplate(){var b=$("#formAddTemplate");var a=new FormData($(b)[0]);var c=$(b).attr("action");$.ajax({url:c,type:"POST",data:a,cache:false,contentType:false,processData:false,success:function(d){if(d.error){sweetAlert("Oops...",d.mensaje,"error")}else{getSmsTemplates();cerrarModal("modalPlantillaSms");sweetAlert({html:false,title:"¡Excelente!",text:"La plantilla se ha guardado correctamente.",type:"success"})}},error:function(d,f,e){sweetAlert("Oops...","Algo salió mal, intenta nuevamente en unos minutos.","error")}})}function viewSmsTemplateDetails(a){$.ajax({type:"POST",dataType:"json",url:$.viewSmsTemplateDetails,data:"idTemplate="+a,success:function(b){$("#statusConfig-div").css("display","none");loadAvailableFields(b.fields);$("#idTemplate").val(b.template.id);$("#contenidoSms").val(b.template.plantilla);initDroppable($("#contenidoSms"));openModal("modalPlantillaSms")},error:function(b,d,c){sweetAlert("Oops...","Algo salió mal, intenta nuevamente en unos minutos.","error")}})}function loadAvailableFields(a){$(".availableFields li").remove();$.each(a,function(){var b='<li class="gray font14 fontWeight500 latterspacing1 paddingTop12" style="cursor:move">';b+=this;b+="</li>";$(".availableFields").append(b)});$(".availableFields li").draggable({appendTo:"body",helper:"clone",cursor:"move",revert:"invalid"})}function deleteSmsTemplate(a){swal({title:"¡Importante!",text:"¿Está seguro que desea eliminar la plantilla definitivamente?",type:"warning",showCancelButton:true,cancelButtonText:"Me equivoque en la selección",confirmButtonColor:"#DD6B55",confirmButtonText:"Sí, continuar",closeOnConfirm:false},function(b){if(b){$.ajax({type:"POST",dataType:"json",url:$.deleteSmsTemplate,data:"idTemplate="+a,success:function(c){if(c.error){sweetAlert("Oops...",c.mensaje,"error")}else{getSmsTemplates();sweetAlert({html:false,title:"¡Excelente!",text:"La plantilla se ha eliminado correctamente.",type:"success"});getCronList()}},error:function(c,e,d){sweetAlert("Oops...","Algo salió mal, intenta nuevamente en unos minutos.","error")}})}})}function validateTemplate(){var a=0;$('span[class*="help-block"]').each(function(){$(this).remove()});if($("#contenidoSms").val().trim()===""){a++;errorMessageTemplate("contenidoSms","El campo es obligatorio ")}else{if($("#contenidoSms").val().length>120){a++;errorMessageTemplate("contenidoSms","El texto no puede contener más de 120 caracteres ")}}if($("#idTemplate").val()==="0"&&$("input[name=status]:checked").length<=0){a++;errorMessageTemplate("status","El campo es obligatorio")}if(a===0){saveSmsTemplate()}}function errorMessageTemplate(a,b){$("#"+a+"-control").html("<span class='help-block marginRight25'><small style='color: red;'>"+b+"</small></span>")};
