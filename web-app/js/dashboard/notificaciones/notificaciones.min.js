
$.getSmsTemplates=$.contextAwarePathJS+"notificaciones/getSmsTemplates";$.loadDataSmsTemplate=$.contextAwarePathJS+"notificaciones/loadDataSmsTemplate";$.viewSmsTemplateDetails=$.contextAwarePathJS+"notificaciones/viewTemplateDetails";$.deleteSmsTemplate=$.contextAwarePathJS+"notificaciones/deleteSmsTemplate";$(document).ready(function(){$("#newSmsTemplate-btn").on("click",function(b){b.preventDefault();loadDataSmsTemplate()});$("#saveSmsTemplate-btn").on("click",function(b){b.preventDefault();validateTemplate()});$("#plantillasSms-tb").on("click","button.smsTemplateDetails",function(c){c.preventDefault();var b=this.getAttribute("data-id");viewSmsTemplateDetails(b)});$("#plantillasSms-tb").on("click","button.deleteSmsTemplate",function(c){c.preventDefault();var b=this.getAttribute("data-id");deleteSmsTemplate(b)});$("#contenidoSms").keyup(a);$("#contenidoSms").keydown(a);function a(){var b=$(this).val().length;$("#characters").text(b)}getSmsTemplates()});function getSmsTemplates(){$.ajax({type:"POST",dataType:"json",url:$.getSmsTemplates,contentType:"application/json",success:function(a){$("#plantillasSms-tb tbody").empty();if(a.templates.length>0){$.each(a.templates,function(d){var e="";if(d===0){e+="<tr></tr>"}e+="<tr>";e+='<td class="left tableTitleColor font12 paddingTop12 paddingRight12 paddingBottom5 paddingLeft10 textUpper">';e+='<span class="textUpper">nombre de plantilla </span><br/>';e+='<span class="font14 tableDescriptionColor textUpper">'+this.nombrePlantilla+"</span>";e+="</td>";e+='<td class="left tableTitleColor font12 paddingTop12 paddingRight12 paddingBottom5 paddingLeft10 textUpper">';e+='<span class="textUpper">tipo de envío </span><br/>';e+='<span class="font14 tableDescriptionColor textUpper">'+(this.tipoDeEnvio===0?"Fijo":"Por Inactividad")+"</span>";e+="</td>";e+='<td class="left tableTitleColor font12 paddingTop12 paddingRight12 paddingBottom5 paddingLeft10 textUpper">';e+='<span class="textUpper">Paso Solicitud </span><br/>';var c=this.status;$.each(a.statusOption,function(f,g){if(f==c){e+='<span class="font14 tableDescriptionColor textUpper">'+g+"</span>"}});e+="</td>";e+='<td class="left tableTitleColor font12 paddingTop12 paddingRight12 paddingBottom5 paddingLeft10">';e+='<span class="textUpper">plantilla </span><br/>';e+='<span class="font14 tableDescriptionColor">'+this.plantilla+"</span>";e+="</td>";e+='<td class="center colorWhite font14 paddingTop5 paddingRight12 paddingBottom5 paddingLeft10 textUpper">';e+='<button class="greenBox colorWhite width100 smsTemplateDetails" data-id="'+this.id+'" type="button">editar</button>';e+="</td>";e+='<td class="center colorWhite font14 paddingTop5 paddingRight12 paddingBottom5 paddingLeft10 textUpper">';e+='<button class="greenBox colorWhite width100 deleteSmsTemplate" data-id="'+this.id+'" type="button">eliminar</button>';e+="</td>";e+="</tr>";$("#plantillasSms-tb tbody:last").append(e)});if(a.statusOption){$("#newSmsTemplate-btn").css("display","block")}else{$("#newSmsTemplate-btn").css("display","none")}}else{var b="";b+="<tr></tr>";b+="<tr>";b+='<td colspan="4" class="left tableTitleColor font12 paddingTop12 paddingRight12 paddingBottom5 paddingLeft10 textUpper">';b+='<span class="font14 tableDescriptionColor">No hay plantillas registradas</span>';b+="</td>";b+="</tr>";$("#plantillasSms-tb tbody:last").append(b)}},error:function(a,c,b){sweetAlert("Oops...","Algo salió mal, intenta nuevamente en unos minutos.","error")}})}function initDroppable(a){a.droppable({accept:":not(.ui-sortable-helper)",drop:function(b,h){var i=h.draggable.text();var e;e="{"+i+"}";var j=a[0].selectionStart;var c=a.val();var f=c.substring(0,j);var d=c.substring(j,c.length);a.val(f+e+d);var g=$("#contenidoSms").val().length;$("#characters").text(g)}})}function loadDataSmsTemplate(){$.ajax({type:"POST",dataType:"json",url:$.loadDataSmsTemplate,beforeSend:function(b,a){$('span[class*="help-block"]').each(function(){$(this).remove()});$("#status-div").empty();$("#characters").empty()},success:function(a){$("#formAddTemplate")[0].reset();$("#idTemplate").val("0");$("#statusConfig-div").css("display","block");loadAvailableFields(a.fields);$.each(a.status,function(c,d){var b=$('<li><input name="status" value="'+c+'" type="radio"> <span class="marginRight20">'+d+"</span></li>");b.appendTo("#status-div")});initDroppable($("#contenidoSms"));openModal("seleccion")},error:function(a,c,b){sweetAlert("Oops...","Algo salió mal, intenta nuevamente en unos minutos.","error")}})}function saveSmsTemplate(){var b=$("#formAddTemplate");var a=new FormData($(b)[0]);var c=$(b).attr("action");$.ajax({url:c,type:"POST",data:a,cache:false,contentType:false,processData:false,success:function(d){if(d.error){sweetAlert("Oops...",d.mensaje,"error")}else{getSmsTemplates();cerrarModal("modalPlantillaSms");cerrarModal("seleccion");sweetAlert({html:false,title:"¡Excelente!",text:"La plantilla se ha guardado correctamente.",type:"success"});getCronList()}},error:function(d,f,e){sweetAlert("Oops...","Algo salió mal, intenta nuevamente en unos minutos.","error")}})}function viewSmsTemplateDetails(a){$.ajax({type:"POST",dataType:"json",url:$.viewSmsTemplateDetails,data:"idTemplate="+a,success:function(b){$("#status-div").empty();$("#statusConfig-div").css("display","block");loadAvailableFields(b.fields);$("#characters").text();$("#idTemplate").val(b.template.id);$("#nombrePlantilla").val(b.template.nombrePlantilla);$("#idTipoDeEnvio").val(b.template.tipoDeEnvio);$("#contenidoSms").val(b.template.plantilla);$("#characters").text($("#contenidoSms").val().length);$.each(b.status,function(d,e){var c;if(parseInt(d)===b.template.status){c=$('<li><input name="status" value="'+d+'" type="radio" checked> <span class="marginRight20">'+e+"</span></li>")}else{c=$('<li><input name="status" value="'+d+'" type="radio"> <span class="marginRight20">'+e+"</span><li>")}c.appendTo("#status-div")});initDroppable($("#contenidoSms"));openModal("modalPlantillaSms")},error:function(b,d,c){sweetAlert("Oops...","Algo salió mal, intenta nuevamente en unos minutos.","error")}})}function loadAvailableFields(a){$(".availableFields li").remove();$.each(a,function(){var b='<li class="gray font14 fontWeight500 latterspacing1 paddingTop12" style="cursor:move">';b+=this;b+="</li>";$(".availableFields").append(b)});$(".availableFields li").draggable({appendTo:"body",helper:"clone",cursor:"move",revert:"invalid"})}function deleteSmsTemplate(a){swal({title:"¡Importante!",text:"¿Está seguro que desea eliminar la plantilla definitivamente?",type:"warning",showCancelButton:true,cancelButtonText:"Me equivoque en la selección",confirmButtonColor:"#DD6B55",confirmButtonText:"Sí, continuar",closeOnConfirm:false},function(b){if(b){$.ajax({type:"POST",dataType:"json",url:$.deleteSmsTemplate,data:"idTemplate="+a,success:function(c){if(c.error){sweetAlert("Oops...",c.mensaje,"error")}else{getSmsTemplates();sweetAlert({html:false,title:"¡Excelente!",text:"La plantilla se ha eliminado correctamente.",type:"success"});getCronList()}},error:function(c,e,d){sweetAlert("Oops...","Algo salió mal, intenta nuevamente en unos minutos.","error")}})}})}function validateTemplate(){var a=0;$('span[class*="help-block"]').each(function(){$(this).remove()});if($("#contenidoSms").val().trim()===""){a++;errorMessageTemplate("contenidoSms","El campo es obligatorio ")}else{if($("#contenidoSms").val().length>120){a++;errorMessageTemplate("contenidoSms","El texto no puede contener más de 120 caracteres ")}}if($("input[name=status]:checked").length<=0){a++;errorMessageTemplate("status","El campo es obligatorio  ")}if($("#nombrePlantilla").val().trim()===""){a++;errorMessageTemplate("nombrePlantillaSms","El campo es obligatorio ")}if(a===0){saveSmsTemplate()}}function errorMessageTemplate(a,b){$("#"+a+"-control").html("<span class='help-block marginRight25'><small style='color: red;'>"+b+"</small></span>")}function seleccionTipoDeEnvio(){if($("input[name=tipoDeEnvio]:checked").val()==="0"){$("#idTipoDeEnvio").val("0");openModal("modalPlantillaSms")}else{if($("input[name=tipoDeEnvio]:checked").val()==="1"){$("#idTipoDeEnvio").val("1");openModal("modalPlantillaSms")}}}function loadAvailableFieldsEmail(a){$(".availableFields li").remove();$.each(a,function(){var b='<li class="prueba gray font14 fontWeight500 latterspacing1 paddingTop12 " style="cursor:move" draggable="true" ';b+='data-elemento="';b+="{";b+=this;b+="}";b+='">';b+=this;b+="</li>";$(".availableFields").append(b)})};