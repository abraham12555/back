
$.loadDataCron="/notificaciones/loadDataCron";$.deleteCron="/notificaciones/deleteCron";$(document).ready(function(){$("#hours-cron").timepicker({showMinutes:false,showPeriod:false,showLeadingZero:false,showPeriodLabels:false,hourText:"Hora"});$(".day-cron").timepicker({showPeriodLabels:false,showLeadingZero:false,hourText:"Hora",minuteText:"Minuto"});$(".day-cron").inputmask({mask:"99:99"});$("#newCronConfiguration-btn").on("click",function(a){a.preventDefault();loadDataCron()});$("#datepickerCron").datepicker({changeMonth:false,changeYear:false,dayNamesMin:["","","","","","",""],stepMonths:0,duration:0,onSelect:function(){var a=$(this).datepicker("getDate");$("#datepickerAux").datepicker("setDate",a);$("#datepickerCron").val(a.getDate())}}).focus(function(){var a=$("#datepickerAux").datepicker("getDate");$("#datepickerCron").datepicker("setDate",a);$("#datepickerCron").val(a.getDate());$(".ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-header, .ui-widget-header").remove()});$("#datepickerAux").datepicker();$("#saveCron-btn").on("click",function(a){a.preventDefault();validateForm()});$("#editCron-btn").on("click",function(a){a.preventDefault();loadDataCron()});$("#deleteCron-btn").on("click",function(a){a.preventDefault();deleteCron()});$(".only-number").keypress(function(a){return validarNumero(a)})});function loadDataCron(){var a=$("#idConfiguracionNotificacion").val();$.ajax({type:"POST",dataType:"json",url:$.loadDataCron,data:"notification="+a,cache:false,beforeSend:function(c,b){$("#leyendaCron").html("")},success:function(c){$("#formAddCron")[0].reset();$("#idNotificacionCron").val(a);$("[name=cronOptions]").val([c.notificacionEnvio.frequency]);$("#hours-cron").val(c.notificacionEnvio.hour);$("#dayTime").val(c.notificacionEnvio.dayTime);$("#daysWeek").val(c.notificacionEnvio.weekDay);$("#weekTime").val(c.notificacionEnvio.weekTime);$("#monthTime").val(c.notificacionEnvio.monthTime);var d=new Date(2017,0,c.notificacionEnvio.dayMonth);$("#datepickerCron").datepicker("setDate",d);var b=$("#datepickerCron").datepicker("getDate").getDate();$("#datepickerCron").val(b);$("#datepickerAux").datepicker("setDate",d);$('input:radio[name="cronOptions"]').change(function(){if($(this).is(":checked")){selectFrequency($(this).val())}$("#leyendaCron").html("")});$("#daysWeek").selectmenu();selectFrequency($('input:radio[name="cronOptions"]:checked').val());openModal("modalEnvio")},error:function(b,d,c){sweetAlert("Oops...","Algo salió mal, intenta nuevamente en unos minutos.","error")}})}function selectFrequency(a){switch(a){case"MINUTO":$("#eachHour").css("display","none");$("#eachDay").css("display","none");$("#eachWeek").css("display","none");$("#eachMonth").css("display","none");break;case"HORA":$("#eachHour").css("display","block");$("#eachDay").css("display","none");$("#eachWeek").css("display","none");$("#eachMonth").css("display","none");break;case"DIA":$("#eachHour").css("display","none");$("#eachDay").css("display","block");$("#eachWeek").css("display","none");$("#eachMonth").css("display","none");break;case"SEMANA":$("#eachHour").css("display","none");$("#eachDay").css("display","none");$("#eachWeek").css("display","block");$("#eachMonth").css("display","none");break;case"MES":$("#eachHour").css("display","none");$("#eachDay").css("display","none");$("#eachWeek").css("display","none");$("#eachMonth").css("display","block");break;default:$("#eachHour").css("display","none");$("#eachDay").css("display","none");$("#eachWeek").css("display","none");$("#eachMonth").css("display","none");break}}function saveCron(){var b=$("#formAddCron");var a=new FormData($(b)[0]);var c=$(b).attr("action");$.ajax({url:c,type:"POST",data:a,cache:false,contentType:false,processData:false,success:function(d){$("#cronMessage").html(d.content);$("#newCron").css("display","none");$("#cronContent").css("display","block");$("#editCron-div").css("display","block");$("#deleteCron-div").css("display","block");cerrarModal("modalEnvio");sweetAlert({html:false,title:"¡Excelente!",text:"La configuración se ha guardado correctamente.",type:"success"})},error:function(d,f,e){sweetAlert("Oops...","Algo salió mal, intenta nuevamente en unos minutos.","error")}})}function deleteCron(){swal({title:"¡Importante!",text:"¿Está seguro que desea cancelar el envío de mensajes definitivamente?",type:"warning",showCancelButton:true,cancelButtonText:"Me equivoque en la selección",confirmButtonColor:"#DD6B55",confirmButtonText:"Sí, continuar",closeOnConfirm:false},function(a){if(a){$.ajax({type:"POST",dataType:"json",url:$.deleteCron,data:"idNotificacion="+$("#idConfiguracionNotificacion").val(),success:function(b){if(b.confirm===true){$("#newCron").css("display","block");$("#cronContent").css("display","none");$("#editCron-div").css("display","none");$("#deleteCron-div").css("display","none");sweetAlert({html:false,title:"¡Excelente!",text:"El envío de mansajes se ha eliminado correctamente.",type:"success"})}},error:function(b,d,c){sweetAlert("Oops...","Algo salió mal, intenta nuevamente en unos minutos.","error")}})}})}function validateForm(){if($("input[name=cronOptions]:checked").length<=0){$("#leyendaCron").html("<small style='color: red;'>Debe seleccionar la frecuencia del envío de mensajes</small>")}else{var a="";$("#leyendaCron").html("");if($("input[name=cronOptions]:checked").val()==="HORA"){if($("#hours-cron").val()===""){a="Debe seleccionar la hora del envío de mensajes"}else{if(!validateHour($("#hours-cron").val())){a="La hora del envío contiene un formato inválido"}}}if($("input[name=cronOptions]:checked").val()==="DIA"){if($("#dayTime").val()===""){a="Debe seleccionar la hora del envío de mensajes"}else{if(!validateHourTime($("#dayTime").val())){a="La hora del envío contiene un formato inválido"}}}if($("input[name=cronOptions]:checked").val()==="SEMANA"){if($("#weekTime").val()===""){a="Debe seleccionar la hora del envío de mensajes"}else{if(!validateHourTime($("#weekTime").val())){a="La hora del envío contiene un formato inválido"}}}if($("input[name=cronOptions]:checked").val()==="MES"){if($("#datepickerCron").val()===""){a="Debe seleccionar el día del envío de mensajes"}else{if(!validateDay($("#datepickerCron").val())){a="El día del envío contiene un formato inválido"}else{if($("#monthTime").val()===""){a="Debe seleccionar la hora del envío de mensajes"}else{if(!validateHourTime($("#monthTime").val())){a="La hora del envío contiene un formato inválido"}}}}}if(a===""){saveCron()}else{$("#leyendaCron").html("<small style='color: red;'>"+a+"</small>")}}}function validateHourTime(a){return(/^(?:([01]?\d|2[0-3]):([0-5]?\d))$/.test(a))}function validateHour(a){return(/^(?:([01]?\d|2[0-3]))$/.test(a))}function validateDay(a){return(/^([1-9]|[12]\d|3[0-1])$/.test(a))}function validarNumero(c){var a=(document.all)?c.keyCode:c.which;if(a===13){return true}if(a===8){return true}if(a===9){return true}if(a===0){return true}var f=/^[0-9]$/;var d=String.fromCharCode(a);document.onkeypress=b;function b(g){return((window.event)?event.keyCode:g.keyCode)!==13}return f.test(d)};