
$.getEmailTemplates="/notificaciones/getEmailTemplates";$.loadDataEmailTemplate="/notificaciones/loadDataEmailTemplate";$.viewEmailTemplateDetails="/notificaciones/viewTemplateDetails";$.deleteEmailTemplate="/notificaciones/deleteEmailTemplate";$(document).ready(function(){$("#newEmailTemplate-btn").on("click",function(a){a.preventDefault();loadDataEmailTemplate()});$("#saveEmailTemplate-btn").on("click",function(a){a.preventDefault();validateEmailTemplate()});$("#plantillasEmail-tb").on("click","button.emailTemplateDetails",function(b){b.preventDefault();var a=this.getAttribute("data-id");viewEmailTemplateDetails(a)});$("#plantillasEmail-tb").on("click","button.deleteEmailTemplate",function(b){b.preventDefault();var a=this.getAttribute("data-id");deleteEmailTemplate(a)});getEmailTemplates()});function getEmailTemplates(){$.ajax({type:"POST",dataType:"json",url:$.getEmailTemplates,contentType:"application/json",success:function(a){$("#plantillasEmail-tb tbody").empty();if(a.templates.length>0){$.each(a.templates,function(c){var d="";if(c===0){d+="<tr></tr>"}d+="<tr>";d+='<td class="left tableTitleColor font12 paddingTop12 paddingRight12 paddingBottom5 paddingLeft10 textUpper">';d+='<span class="textUpper">estatus </span><br/>';d+='<span class="font14 tableDescriptionColor textUpper">'+this.status+"</span>";d+="</td>";d+='<td class="left tableTitleColor font12 paddingTop12 paddingRight12 paddingBottom5 paddingLeft10">';d+='<span class="textUpper">asunto </span><br/>';d+='<span class="font14 tableDescriptionColor">'+this.asunto+"</span>";d+="</td>";d+='<td class="left tableTitleColor font12 paddingTop12 paddingRight12 paddingBottom5 paddingLeft10">';d+='<span class="textUpper">plantilla </span><br/>';d+='<span class="font14 tableDescriptionColor">'+this.plantilla+"</span>";d+="</td>";d+='<td class="center colorWhite font14 paddingTop5 paddingRight12 paddingBottom5 paddingLeft10 textUpper">';d+='<button class="greenBox colorWhite width100 emailTemplateDetails" data-id="'+this.id+'" type="button">editar</button>';d+="</td>";d+='<td class="center colorWhite font14 paddingTop5 paddingRight12 paddingBottom5 paddingLeft10 textUpper">';d+='<button class="greenBox colorWhite width100 deleteEmailTemplate" data-id="'+this.id+'" type="button">eliminar</button>';d+="</td>";d+="</tr>";$("#plantillasEmail-tb tbody:last").append(d);if(a.statusOption){$("#newEmailTemplate-btn").css("display","block")}else{$("#newEmailTemplate-btn").css("display","none")}})}else{var b="";b+="<tr></tr>";b+="<tr>";b+='<td colspan="4" class="left tableTitleColor font12 paddingTop12 paddingRight12 paddingBottom5 paddingLeft10 textUpper">';b+='<span class="font14 tableDescriptionColor">No hay plantillas registradas</span>';b+="</td>";b+="</tr>";$("#plantillasEmail-tb tbody:last").append(b)}},error:function(a,c,b){sweetAlert("Oops...","Algo salió mal, intenta nuevamente en unos minutos.","error")}})}function loadDataEmailTemplate(){$.ajax({type:"POST",dataType:"json",url:$.loadDataEmailTemplate,beforeSend:function(b,a){$('span[class*="help-block"]').each(function(){$(this).remove()});$("#statusEmail-div").empty()},success:function(a){$("#formAddEmailTemplate")[0].reset();$("#idEmailTemplate").val("0");$("#statusEmailConfig-div").css("display","block");loadAvailableFields(a.fields);$.each(a.status,function(){var b=$('<input name="statusEmail" value="'+this+'" type="radio"> <span class="marginRight20">'+this+"</span>");b.appendTo("#statusEmail-div")});initDroppable($("#contenidoEmail"));openModal("modalPlantillaEmail")},error:function(a,c,b){sweetAlert("Oops...","Algo salió mal, intenta nuevamente en unos minutos.","error")}})}function saveEmailTemplate(){var b=$("#formAddEmailTemplate");var a=new FormData($(b)[0]);var c=$(b).attr("action");$.ajax({url:c,type:"POST",data:a,cache:false,contentType:false,processData:false,success:function(d){if(d.error){sweetAlert("Oops...",d.mensaje,"error")}else{getEmailTemplates();cerrarModal("modalPlantillaEmail");sweetAlert({html:false,title:"¡Excelente!",text:"La plantilla se ha guardado correctamente.",type:"success"})}},error:function(d,f,e){sweetAlert("Oops...","Algo salió mal, intenta nuevamente en unos minutos.","error")}})}function viewEmailTemplateDetails(a){$.ajax({type:"POST",dataType:"json",url:$.viewEmailTemplateDetails,data:"idTemplate="+a,beforeSend:function(c,b){$('span[class*="help-block"]').each(function(){$(this).remove()})},success:function(b){$("#statusEmailConfig-div").css("display","none");loadAvailableFields(b.fields);$("#idEmailTemplate").val(b.template.id);$("#contenidoEmail").val(b.template.plantilla);$("#emailAsunto").val(b.template.asunto);initDroppable($("#contenidoEmail"));openModal("modalPlantillaEmail")},error:function(b,d,c){sweetAlert("Oops...","Algo salió mal, intenta nuevamente en unos minutos.","error")}})}function deleteEmailTemplate(a){swal({title:"¡Importante!",text:"¿Está seguro que desea eliminar la plantilla definitivamente?",type:"warning",showCancelButton:true,cancelButtonText:"Me equivoque en la selección",confirmButtonColor:"#DD6B55",confirmButtonText:"Sí, continuar",closeOnConfirm:false},function(b){if(b){$.ajax({type:"POST",dataType:"json",url:$.deleteEmailTemplate,data:"idTemplate="+a,success:function(c){if(c.error){sweetAlert("Oops...",c.mensaje,"error")}else{getEmailTemplates();sweetAlert({html:false,title:"¡Excelente!",text:"La plantilla se ha eliminado correctamente.",type:"success"});getCronList()}},error:function(c,e,d){sweetAlert("Oops...","Algo salió mal, intenta nuevamente en unos minutos.","error")}})}})}function validateEmailTemplate(){var a=0;$('span[class*="help-block"]').each(function(){$(this).remove()});if($("#contenidoEmail").val().trim()===""){a++;errorMessageTemplate("contenidoEmail","El campo es obligatorio")}else{if($("#contenidoEmail").val().trim().length>500){a++;errorMessageTemplate("contenidoEmail","El texto no puede contener más de 500 caracteres")}}if($("#emailAsunto").val().trim()===""){a++;errorMessageTemplate("emailAsunto","El campo es obligatorio")}else{if($("#emailAsunto").val().trim().length>100){a++;errorMessageTemplate("emailAsunto","El texto no puede contener más de 100 caracteres")}}if($("#idEmailTemplate").val()==="0"&&$("input[name=statusEmail]:checked").length<=0){a++;errorMessageTemplate("statusEmail","El campo es obligatorio")}if(a===0){saveEmailTemplate()}};