
$.getEmailTemplates=$.contextAwarePathJS+"notificaciones/getEmailTemplates";$.loadDataEmailTemplate=$.contextAwarePathJS+"notificaciones/loadDataEmailTemplate";$.viewEmailTemplateDetails=$.contextAwarePathJS+"notificaciones/viewTemplateDetails";$.deleteEmailTemplate=$.contextAwarePathJS+"notificaciones/deleteEmailTemplate";$(document).ready(function(){$("#newEmailTemplate-btn").on("click",function(a){a.preventDefault();loadDataEmailTemplate()});$("#saveEmailTemplate-btn").on("click",function(a){a.preventDefault();validateEmailTemplate()});$("#plantillasEmail-tb").on("click","button.emailTemplateDetails",function(b){b.preventDefault();var a=this.getAttribute("data-id");viewEmailTemplateDetails(a)});$("#plantillasEmail-tb").on("click","button.deleteEmailTemplate",function(b){b.preventDefault();var a=this.getAttribute("data-id");deleteEmailTemplate(a)});getEmailTemplates()});function getEmailTemplates(){$.ajax({type:"POST",dataType:"json",url:$.getEmailTemplates,contentType:"application/json",success:function(a){$("#plantillasEmail-tb tbody").empty();if(a.templates.length>0){$.each(a.templates,function(c){var e="";if(c===0){e+="<tr></tr>"}e+="<tr>";e+='<td class="left tableTitleColor font12 paddingTop12 paddingRight12 paddingBottom5 paddingLeft10 textUpper">';e+='<span class="textUpper">nombre de plantilla </span><br/>';e+='<span class="font14 tableDescriptionColor textUpper">'+this.nombrePlantilla+"</span>";e+="</td>";e+='<td class="left tableTitleColor font12 paddingTop12 paddingRight12 paddingBottom5 paddingLeft10 textUpper">';e+='<span class="textUpper">tipo de envío </span><br/>';e+='<span class="font14 tableDescriptionColor textUpper">'+(this.tipoDeEnvio===0?"Fijo":"Por Inactividad")+"</span>";e+="</td>";e+='<td class="left tableTitleColor font12 paddingTop12 paddingRight12 paddingBottom5 paddingLeft10 textUpper">';e+='<span class="textUpper">Paso Solicitud </span><br/>';var d=this.status;$.each(a.statusOption,function(f,g){if(f==d){e+='<span class="font14 tableDescriptionColor textUpper">'+g+"</span>"}});e+="</td>";e+='<td class="left tableTitleColor font12 paddingTop12 paddingRight12 paddingBottom5 paddingLeft10">';e+='<span class="textUpper">asunto </span><br/>';e+='<span class="font14 tableDescriptionColor">'+this.asunto+"</span>";e+="</td>";e+='<td class="left tableTitleColor font12 paddingTop12 paddingRight12 paddingBottom5 paddingLeft10">';e+='<span class="textUpper">plantilla </span><br/>';e+='<span class="font14 tableDescriptionColor">'+this.plantilla+"</span>";e+="</td>";e+='<td class="center colorWhite font14 paddingTop5 paddingRight12 paddingBottom5 paddingLeft10 textUpper">';e+='<button class="greenBox colorWhite width100 emailTemplateDetails" data-id="'+this.id+'" type="button">editar</button>';e+="</td>";e+='<td class="center colorWhite font14 paddingTop5 paddingRight12 paddingBottom5 paddingLeft10 textUpper">';e+='<button class="greenBox colorWhite width100 deleteEmailTemplate" data-id="'+this.id+'" type="button">eliminar</button>';e+="</td>";e+="</tr>";$("#plantillasEmail-tb tbody:last").append(e);if(a.statusOption){$("#newEmailTemplate-btn").css("display","block")}else{$("#newEmailTemplate-btn").css("display","none")}})}else{var b="";b+="<tr></tr>";b+="<tr>";b+='<td colspan="4" class="left tableTitleColor font12 paddingTop12 paddingRight12 paddingBottom5 paddingLeft10 textUpper">';b+='<span class="font14 tableDescriptionColor">No hay plantillas registradas</span>';b+="</td>";b+="</tr>";$("#plantillasEmail-tb tbody:last").append(b)}},error:function(a,c,b){sweetAlert("Oops...","Algo salió mal, intenta nuevamente en unos minutos.","error")}})}function loadDataEmailTemplate(){$.ajax({type:"POST",dataType:"json",url:$.loadDataEmailTemplate,beforeSend:function(b,a){$('span[class*="help-block"]').each(function(){$(this).remove()});$("#statusEmail-div").empty()},success:function(a){$("#formAddEmailTemplate")[0].reset();$("#idEmailTemplate").val("0");$("#statusEmailConfig-div").css("display","block");loadAvailableFieldsEmail(a.fields);$.each(a.status,function(c,d){var b=$('<li><input name="statusEmail" value="'+c+'" type="radio"> <span class="marginRight20">'+d+"</span></li>");b.appendTo("#statusEmail-div")});dragNDrop();openModal("seleccionEmail")},error:function(a,c,b){sweetAlert("Oops...","Algo salió mal, intenta nuevamente en unos minutos.","error")}})}function saveEmailTemplate(){var b=$("#formAddEmailTemplate");var a=new FormData($(b)[0]);var c=$(b).attr("action");$.ajax({url:c,type:"POST",data:a,cache:false,contentType:false,processData:false,success:function(d){if(d.error){sweetAlert("Oops...",d.mensaje,"error")}else{getEmailTemplates();cerrarModal("modalPlantillaEmail");cerrarModal("seleccionEmail");sweetAlert({html:false,title:"¡Excelente!",text:"La plantilla se ha guardado correctamente.",type:"success"});getCronList()}},error:function(d,f,e){sweetAlert("Oops...","Algo salió mal, intenta nuevamente en unos minutos.","error")}})}function viewEmailTemplateDetails(a){$.ajax({type:"POST",dataType:"json",url:$.viewEmailTemplateDetails,data:"idTemplate="+a,beforeSend:function(c,b){$('span[class*="help-block"]').each(function(){$(this).remove()});$("#statusEmail-div").empty()},success:function(b){iniciarSummernote();$("#statusEmailConfig-div").css("display","block");loadAvailableFieldsEmail(b.fields);$("#idEmailTemplate").val(b.template.id);$("#idTipoDeEnvioEmail").val(b.template.tipoDeEnvio);$("#summernote").summernote("code",b.template.plantilla);$("#emailAsunto").val(b.template.asunto);$("#nombrePlantillaEmail").val(b.template.nombrePlantilla);$.each(b.status,function(d,e){var c;if(parseInt(d)===b.template.status){c=$('<li><input name="statusEmail" value="'+d+'" type="radio" checked> <span class="marginRight20">'+e+"</span></li>")}else{c=$('<li><input name="statusEmail" value="'+d+'" type="radio"> <span class="marginRight20">'+e+"</span></li>")}c.appendTo("#statusEmail-div")});dragNDrop();openModal("modalPlantillaEmail")},error:function(b,d,c){sweetAlert("Oops...","Algo salió mal, intenta nuevamente en unos minutos.","error")}})}function deleteEmailTemplate(a){swal({title:"¡Importante!",text:"¿Está seguro que desea eliminar la plantilla definitivamente?",type:"warning",showCancelButton:true,cancelButtonText:"Me equivoque en la selección",confirmButtonColor:"#DD6B55",confirmButtonText:"Sí, continuar",closeOnConfirm:false},function(b){if(b){$.ajax({type:"POST",dataType:"json",url:$.deleteEmailTemplate,data:"idTemplate="+a,success:function(c){if(c.error){sweetAlert("Oops...",c.mensaje,"error")}else{getEmailTemplates();sweetAlert({html:false,title:"¡Excelente!",text:"La plantilla se ha eliminado correctamente.",type:"success"});getCronList()}},error:function(c,e,d){sweetAlert("Oops...","Algo salió mal, intenta nuevamente en unos minutos.","error")}})}})}function validateEmailTemplate(){var a=0;$('span[class*="help-block"]').each(function(){$(this).remove()});if($("#summernote").val().trim()===""){a++;errorMessageTemplate("contenidoEmail","El campo es obligatorio")}else{if($("#summernote").val().trim().length>2000){a++;errorMessageTemplate("contenidoEmail","El texto no puede contener más de 2000 caracteres")}}if($("#emailAsunto").val().trim()===""){a++;errorMessageTemplate("emailAsunto","El campo es obligatorio")}else{if($("#emailAsunto").val().trim().length>100){a++;errorMessageTemplate("emailAsunto","El texto no puede contener más de 100 caracteres")}}if($("input[name=statusEmail]:checked").length<=0){a++;errorMessageTemplate("statusEmail","El campo es obligatorio")}if($("#nombrePlantillaEmail").val().trim()===""){a++;errorMessageTemplate("nombrePlantillaEmail","El campo es obligatorio")}if(a===0){saveEmailTemplate()}}function seleccionTipoDeEnvioEmail(){if($("input[name=tipoDeEnvioEmail]:checked").val()==="0"){$("#idTipoDeEnvioEmail").val("0");openModal("modalPlantillaEmail");iniciarSummernote()}else{if($("input[name=tipoDeEnvioEmail]:checked").val()==="1"){$("#idTipoDeEnvioEmail").val("1");openModal("modalPlantillaEmail");iniciarSummernote()}}}function dragNDrop(){$(".prueba").on("dragstart",function(b){var a=$(b.currentTarget).data("elemento");b.originalEvent.dataTransfer.setData("Text",a)})}function iniciarSummernote(){$("#summernote").summernote("destroy");$("#summernote").summernote({toolbar:[["style",["bold","italic","underline","clear"]],["color",["color"]],["para",["ul","ol","paragraph"]],["view",["codeview"]]],height:200,width:400,disableDragAndDrop:true});$("#summernote").summernote("code","")};