
$.getUsers=$.contextAwarePathJS+"dashboard/getUsers";$.getUserDetails=$.contextAwarePathJS+"dashboard/getUserDetails";$.validNoEmpleado=$.contextAwarePathJS+"dashboard/validNoEmpleado";$.validNewPassword=$.contextAwarePathJS+"dashboard/validNewPassword";$.userAuthentication=false;$.currentValue;$(document).ready(function(){$("#saveUser-btn").on("click",function(a){a.preventDefault();validateUserInfoForm()});$("#newUser-btn").on("click",function(a){a.preventDefault();resetUserForm();$("#userId").val("0");$("#password-div").css("display","block");$("#lock-div").css("display","none");$("#enabled-div").css("display","none");$("#resetPassword-div").css("display","none");$("#newPassword-div").css("display","none");$("#operation-title").html("registro de usuario");openModal("modalAltaDeUsuario")});$("#usuarios-tb").on("click","button.userDetails",function(b){b.preventDefault();var a=this.getAttribute("data-id");viewUserDetails(a)});$("#pagination").on("click","a.page",function(a){a.preventDefault();var b=$(this).data("page");getUsers(b)});$("#rol").focus(function(){if(!$.userAuthentication&&$("#userId").val()!=="0"){$('span[class*="help-block"]').each(function(){$(this).remove()});$("#formUserAuthentication")[0].reset();openModal("loginUsuario");$("#rol").val($.currentValue).change();$("#rol").css("display","none")}});$("#autenticarUsuario-btn").on("click",function(a){a.preventDefault();userAuthentication()});$("#cancelUserAuthentication-btn").on("click",function(a){a.preventDefault();$("#rol").css("display","block");cerrarModal("loginUsuario")});$("#username").keyup(function(){this.value=this.value.toLowerCase()});$('input[name="resetPassword"]').click(function(){$("#newPassword-div").toggle($("input[name='resetPassword']:checked").val())});getUsers(1)});function getUsers(b){$("#currentPage").val(b);var a=new Object();a.page=b;$.ajax({type:"POST",dataType:"json",url:$.getUsers,data:JSON.stringify(a),contentType:"application/json",beforeSend:function(d,c){$("#error-users-div").addClass("hide")},success:function(c){var e=c.page;var d=c.totalPages;$("#pagination").empty();$("#usuarios-tb tbody").empty();if(c.usuarios.length>0){pagination(d,e,"pagination");$.each(c.usuarios,function(g){var h="";if(g===0){h+="<tr></tr>"}h+="<tr>";h+='<td class="left tableTitleColor font12 paddingTop12 paddingRight12 paddingBottom5 paddingLeft10 textUpper">';h+="Nombre de usuario <br/>";h+='<span class="font14 textlower tableDescriptionColor">'+this.username+"</span>";h+="</td>";h+='<td class="left tableTitleColor font12 paddingTop12 paddingRight12 paddingBottom5 paddingLeft10 textUpper">';h+="nombre <br/>";h+='<span class="font14 tableDescriptionColor textUpper">'+this.fullName+"</span>";h+="</td>";h+='<td class="left tableTitleColor font12 paddingTop12 paddingRight12 paddingBottom5 paddingLeft10 textUpper">';h+="correo electrónico <br/>";h+='<span class="font14 textlower tableDescriptionColor">'+this.email+"</span>";h+="</td>";h+='<td class="left tableTitleColor font12 paddingTop12 paddingRight12 paddingBottom5 paddingLeft10 textUpper">';h+="rol <br/>";$.each(this.authorities,function(j){if(j>0){h+="<br/>"}h+='<span class="font14 textUpper tableDescriptionColor">'+this.authority+"</span>"});h+="</td>";h+='<td class="center colorWhite font14 paddingTop5 paddingRight12 paddingBottom5 paddingLeft10 textUpper">';h+='<button class="greenBox colorWhite userDetails" data-id="'+this.id+'" type="button">editar</button>';h+="</td>";h+="</tr>";$("#usuarios-tb tbody:last").append(h)})}else{var f="";f+="<tr></tr>";f+="<tr>";f+='<td colspan="5" class="left tableTitleColor font12 paddingTop12 paddingRight12 paddingBottom5 paddingLeft10 textUpper">';f+='<span class="font14 tableDescriptionColor">No hay usuarios registrados</span>';f+="</td>";f+="</tr>";$("#usuarios-tb tbody:last").append(f)}},error:function(c,e,d){$("#error-users-div").html("Ocurrió un error al obtener la lista de usuarios. Inténtalo más tarde");$("#error-users-div").removeClass("hide")}})}function validateUserInfoForm(){var a=0;$('span[class*="help-block"]').each(function(){$(this).remove()});if($("#name").val().trim()===""){a++;errorMessage("name","El campo es obligatorio")}if($("#apPaterno").val().trim()===""){a++;errorMessage("apPaterno","El campo es obligatorio")}if($("#apMaterno").val().trim()===""){a++;errorMessage("apMaterno","El campo es obligatorio")}if($("#username").val().trim()===""){a++;errorMessage("username","El campo es obligatorio")}else{if($("#username").val().length<6||$("#username").val().length>15){a++;errorMessage("username","El nombre de usuario debe contener mínimo 6 y máximo 15 caracteres")}}if($("#userId").val()==="0"&&$("#password").val().trim()===""){a++;errorMessage("password","El campo es obligatorio")}else{if($("#userId").val()==="0"&&!validatePassword($("#password").val().trim())){a++;errorMessage("password","La contraseña debe contener mínimo 8 y máximo 12 caracteres, al menos una letra mayúscula, una letra minúscula, un número y un caracter especial")}}if($("#email").val().trim()===""){a++;errorMessage("email","El campo es obligatorio")}else{if(!validateEmail($("#email").val())){a++;errorMessage("email","Tu dirección de correo es incorrecta, verifica la estructura. Ej. ejemplo@mail.com")}}if($("#sucursal").val().length===0){a++;errorMessage("sucursal","El campo es obligatorio")}if($("#noEmpleado").val().trim()===""){a++;errorMessage("noEmpleado","El campo es obligatorio")}if($("#rol").val()===null||$("#rol").val().length===0){a++;errorMessage("rol","El campo es obligatorio")}if($("#userId").val()!=="0"&&$("input[name='resetPassword']:checked").val()==="true"){if($("#newPassword").val().trim()===""){a++;errorMessage("newPassword","El campo es obligatorio")}else{if(!validatePassword($("#newPassword").val().trim())){a++;errorMessage("newPassword","La contraseña debe contener mínimo 8 y máximo 12 caracteres, al menos una letra mayúscula, una letra minúscula, un número y un caracter especial")}}}if(a===0){validUsername(function(b){if(b.estatus===false){errorMessage("username","El nombre de usuario ya ha sido registrado")}else{if(b.estatus==="ERROR"){errorMessage("username","Ocurrió un error al validar el nombre de usuario")}else{validEmail(function(c){if(c.estatus===false){errorMessage("email","La cuenta de correo electrónico ya ha sido registrada")}else{if(c.estatus==="ERROR"){errorMessage("email","Ocurrió un error al validar la cuenta de correo electrónico")}else{validNoEmpleado(function(d){if(d.estatus===false){errorMessage("noEmpleado","El número de empleado ya ha sido registrado")}else{if(d.estatus==="ERROR"){errorMessage("noEmpleado","Ocurrió un error al validar el número de empleado")}else{validNewPassword(function(e){if(e.error===true){errorMessage("newPassword",e.mensaje)}else{if(e.estatus==="ERROR"){errorMessage("newPassword","Ocurrió un error al validar la contraseña")}else{submitUserForm()}}})}}})}}})}}})}}function errorMessage(a,b){$("#"+a+"-control").html("<span class='help-block marginRight25'><small style='color: red;'>"+b+"</small></span>")}function resetUserForm(){$('span[class*="help-block"]').each(function(){$(this).remove()});$("#formAltaUsuario")[0].reset()}function viewUserDetails(a){$.ajax({type:"POST",dataType:"json",url:$.getUserDetails,data:"idUser="+a,cache:false,success:function(c){resetUserForm();var d=[];var b=(c.sucursal!==null)?c.sucursal.id:"";$.each(c.authorities,function(){d.push(this.id)});$("#userId").val(c.id);$("#name").val(c.nombre);$("#apPaterno").val(c.apellidoPaterno);$("#apMaterno").val(c.apellidoMaterno);$("#username").val(c.username);$("#password-div").css("display","none");$("#email").val(c.email);$("#rol").val(d).change();$("#sucursal").val(b).change();$("#noEmpleado").val(c.noEmpleado);$("input[name='accountLocked'][value="+c.accountLocked+"]").prop("checked",true);$("input[name='enabled'][value="+c.enabled+"]").prop("checked",true);$("#lock-div").css("display","block");$("#enabled-div").css("display","block");$("#resetPassword-div").css("display","block");$("#newPassword-div").css("display","none");$("#operation-title").html("datos del usuario");$.userAuthentication=false;$.currentValue=d;openModal("modalAltaDeUsuario")},error:function(b,d,c){sweetAlert("Oops...","Algo salió mal, intenta nuevamente en unos minutos.","error")}})}function validNoEmpleado(b){var a=new Object();a.id=$("#userId").val().trim();a.noEmpleado=$("#noEmpleado").val().trim();$.ajax({type:"POST",dataType:"json",url:$.validNoEmpleado,data:JSON.stringify(a),contentType:"application/json",cache:false,success:function(c){b(c)},error:function(d,f,e){var c={estatus:"ERROR"};b(c)}})}function submitUserForm(){var b=$("#formAltaUsuario");var a=new FormData($(b)[0]);var c=$(b).attr("action");$.ajax({url:c,type:"POST",data:a,cache:false,contentType:false,processData:false,success:function(d){if(d.error){sweetAlert("Oops...",d.mensaje,"error")}else{cerrarModal("modalAltaDeUsuario");getUsers(parseInt($("#currentPage").val()));sweetAlert({html:false,title:"¡Excelente!",text:"Los datos del usuario se han guardado correctamente.",type:"success"})}},error:function(d,f,e){sweetAlert("Oops...","Algo salió mal, intenta nuevamente en unos minutos.","error")}})}function userAuthentication(){$('span[class*="help-block"]').each(function(){$(this).remove()});if($("#authPassword").val().trim()===""){errorMessage("authPassword","El campo es obligatorio")}else{var b=$("#formUserAuthentication");var a=new FormData($(b)[0]);var c=$(b).attr("action");$.ajax({url:c,type:"POST",data:a,cache:false,contentType:false,processData:false,success:function(d){if(d.estatus){$.userAuthentication=true;$("#rol").css("display","block");cerrarModal("loginUsuario")}else{errorMessage("authPassword",d.message)}},error:function(d,f,e){sweetAlert("Oops...","Algo salió mal, intenta nuevamente en unos minutos.","error")}})}}function validNewPassword(c){if($("#userId").val()==="0"||$("input[name='resetPassword']:checked").val()==="false"){var a={error:false};c(a)}else{var b=new Object();b.id=$("#userId").val().trim();b.password=$("#newPassword").val().trim();$.ajax({type:"POST",dataType:"json",url:$.validNewPassword,data:JSON.stringify(b),contentType:"application/json",cache:false,success:function(d){c(d)},error:function(e,g,f){var d={estatus:"ERROR"};c(d)}})}};