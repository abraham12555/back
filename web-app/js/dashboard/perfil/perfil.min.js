
$.getProfile=$.contextAwarePathJS+"dashboard/getProfile";$.deleteProfilePicture=$.contextAwarePathJS+"dashboard/deleteProfilePicture";$.defaultProfilePicture=$.contextAwarePathJS+"images/profile.png";$(document).ready(function(){$("#editProfile-btn").on("click",function(a){a.preventDefault();if($(this).text()==="EDITAR"){$("#name").prop("disabled",false);$("#apPaterno").prop("disabled",false);$("#apMaterno").prop("disabled",false);$("#username").prop("disabled",false);$("#email").prop("disabled",false);$("#editProfile-btn").html("GUARDAR CAMBIOS");$("#discardChanges-btn").css("display","block")}else{validateProfileForm()}});$("#discardChanges-btn").on("click",function(a){a.preventDefault();getProfile()});$("#updatePassword-btn").on("click",function(a){a.preventDefault();$('p[class*="help-block"]').each(function(){$(this).remove()});openModal("updatePassword")});$("#changePassword-btn").on("click",function(a){a.preventDefault();validateNewPassword()});$("#cancelUpdatePassword-btn").on("click",function(a){a.preventDefault();cerrarModal("updatePassword")});$("#editProfilePicture-btn").on("click",function(a){a.preventDefault();openModal("updateProfilePicture")});$("#cancelChangePicture-btn").on("click",function(a){a.preventDefault();resetProfilePictureForm()});$("#cancelChangePicture-btn").on("click",function(a){a.preventDefault();resetProfilePictureForm()});$("#deleteProfilePicture-btn").on("click",function(a){a.preventDefault();deleteProfilePicture()});getProfile()});function getProfile(){$.ajax({type:"POST",dataType:"json",url:$.getProfile,cache:false,beforeSend:function(b,a){$('p[class*="help-block"]').each(function(){$(this).remove()});$("#formProfile")[0].reset()},success:function(a){$("#userId").val(a.id);$("#name").val(a.nombre);$("#apPaterno").val(a.apellidoPaterno);$("#apMaterno").val(a.apellidoMaterno);$("#username").val(a.username);$("#email").val(a.email);$("#name").prop("disabled",true);$("#apPaterno").prop("disabled",true);$("#apMaterno").prop("disabled",true);$("#username").prop("disabled",true);$("#email").prop("disabled",true);$("#editProfile-btn").html("EDITAR");$("#discardChanges-btn").css("display","none")},error:function(a,c,b){sweetAlert("Oops...","Algo salió mal, intenta nuevamente en unos minutos.","error")}})}function validateProfileForm(){var a=0;$('p[class*="help-block"]').each(function(){$(this).remove()});if($("#name").val().trim()===""){a++;errorProfileMessage($("#name"),"El campo es obligatorio")}if($("#apPaterno").val().trim()===""){a++;errorProfileMessage($("#apPaterno"),"El campo es obligatorio")}if($("#apMaterno").val().trim()===""){a++;errorProfileMessage($("#apMaterno"),"El campo es obligatorio")}if($("#username").val().trim()===""){a++;errorProfileMessage($("#username"),"El campo es obligatorio")}else{if($("#username").val().length<6||$("#username").val().length>15){a++;errorProfileMessage($("#username"),"El nombre de usuario debe contener mínimo 6 y máximo 15 caracteres")}}if($("#email").val().trim()===""){a++;errorProfileMessage($("#email"),"El campo es obligatorio")}else{if(!validateEmail($("#email").val())){a++;errorProfileMessage($("#email"),"Tu dirección de correo es incorrecta, verifica la estructura. Ej. ejemplo@mail.com")}}if(a===0){validUsername(function(b){if(b.estatus===false){errorProfileMessage($("#username"),"El nombre de usuario ya ha sido registrado")}else{if(b.estatus==="ERROR"){errorProfileMessage($("#username"),"Ocurrió un error al validar el nombre de usuario")}else{validEmail(function(c){if(c.estatus===false){errorProfileMessage($("#email"),"La cuenta de correo electrónico ya ha sido registrada")}else{if(c.estatus==="ERROR"){errorProfileMessage($("#email"),"Ocurrió un error al validar la cuenta de correo electrónico")}else{submitProfileForm()}}})}}})}}function submitProfileForm(){var b=$("#formProfile");var a=new FormData($(b)[0]);var c=$(b).attr("action");$.ajax({url:c,type:"POST",data:a,cache:false,contentType:false,processData:false,success:function(d){if(d.error){sweetAlert("Oops...",d.mensaje,"error")}else{getProfile();sweetAlert({html:false,title:"¡Excelente!",text:"Los datos del usuario se han guardado correctamente.",type:"success"})}},error:function(d,f,e){sweetAlert("Oops...","Algo salió mal, intenta nuevamente en unos minutos.","error")}})}function errorProfileMessage(a,b){a.closest(".control").before("<p class='help-block marginRight25'><small style='color: red;'>"+b+"</small></p>")}function validateNewPassword(){var a=0;$('p[class*="help-block"]').each(function(){$(this).remove()});if($("#password").val().trim()===""){a++;errorProfileMessage($("#password"),"El campo es obligatorio")}else{if(!validatePassword($("#password").val().trim())){a++;errorProfileMessage($("#password"),"La contraseña debe contener mínimo 8 y máximo 12 caracteres, al menos una letra mayúscula, una letra minúscula, un número y un caracter especial")}else{if($("#password").val().trim()!==$("#confirm-password").val().trim()){a++;errorProfileMessage($("#confirm-password"),"Las contraseñas no coinciden")}}}if(a===0){updatePassword()}}function updatePassword(){var a=$("#updatePassword-form");var b=$(a).attr("action");$.post(b,$("#updatePassword-form").serialize(),function(c){if(c.error){errorProfileMessage($("#password"),c.mensaje)}else{sweetAlert({html:false,title:"¡Excelente!",text:"La contraseña se ha guardado correctamente.",type:"success"});cerrarModal("updatePassword")}}).fail(function(){sweetAlert("Oops...","Algo salió mal, intenta nuevamente en unos minutos.","error")})};